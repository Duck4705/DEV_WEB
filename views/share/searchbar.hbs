<form id="searchForm" class="align_row topbar-group searchBar" style="color: white; position: relative;">
    <input type="text" name="query" id="searchInput" placeholder="TÃ¬m phim" style="padding: 10px 20px; border-radius: 50px; font-size: 15px; width: 300px;" autocomplete="off">
    <button type="submit" style="background: none; border: none; margin-left: -35px; cursor: pointer;">
        <i style="color: black; font-size: 15px;" class="ph ph-magnifying-glass"></i>
    </button>
    <div id="searchSuggestions" class="search-suggestions" style="display: none; position: absolute; top: 100%; left: 0; width: 300px; background: white; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 5px; z-index: 1000; max-height: 400px; overflow-y: auto;"></div>
</form>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('searchInput');
    const suggestionsContainer = document.getElementById('searchSuggestions');
    const searchForm = document.getElementById('searchForm');
    let debounceTimer;

    // Helper function to format search terms for URLs
    const formatForUrl = (text) => {
        return text
            .toLowerCase()
            .trim()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-');
    };

    if (searchInput && suggestionsContainer) {
        // Handle form submission
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = searchInput.value.trim();
            
            if (query.length < 2) {
                return;
            }

            // Navigate to SEO-friendly URL
            window.location.href = `/search/${formatForUrl(query)}`;
        });

        // Auto-suggest functionality
        searchInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            const query = searchInput.value.trim();
            
            if (query.length < 2) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            debounceTimer = setTimeout(() => {
                fetch(`/search/api/suggest?query=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(suggestions => {
                        if (suggestions.length > 0) {
                            suggestionsContainer.innerHTML = suggestions.map(movie => `
                                <a href="${movie.url}" class="suggestion-item" style="display: flex; align-items: center; padding: 10px; text-decoration: none; color: black; border-bottom: 1px solid #eee;">
                                    <img src="${movie.poster}" alt="${movie.title}" style="width: 40px; height: 60px; object-fit: cover; margin-right: 10px; border-radius: 5px;">
                                    <span style="font-size: 14px;">${movie.title}</span>
                                </a>
                            `).join('');
                            suggestionsContainer.style.display = 'block';
                        } else {
                            suggestionsContainer.style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching suggestions:', error);
                        suggestionsContainer.style.display = 'none';
                    });
            }, 300);
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.style.display = 'none';
            }
        });
    }
});
</script>

<style>
.suggestion-item:hover {
    background-color: #f5f5f5;
}
.search-suggestions::-webkit-scrollbar {
    width: 8px;
}
.search-suggestions::-webkit-scrollbar-track {
    background: #f1f1f1;
}
.search-suggestions::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}
.search-suggestions::-webkit-scrollbar-thumb:hover {
    background: #555;
}
</style> 